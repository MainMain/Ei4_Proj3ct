<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<!--<title>Développement v0.1</title>-->
		<!--<script src="/model/server.js"></script>-->
		<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
		<script src="/socket.io/socket.io.js"></script>
	</head>
	<body>
		<h2>Commandes</h2>

		<p>
			<input type="button" value="Go gauche !" id="MOVE_LEFT" />
			<input type="button" value="Go droite !" id="MOVE_RIGHT" />
			<input type="button" value="Go haut !" id="MOVE_TOP" />
			<input type="button" value="Go bas !" id="MOVE_BOTTOM" />
			<input type="button" value="Infos case!" id="INFO_CASE" />
			<input type="button" value="Infos perso!" id="INFO_PERSONNAGE" />
			<input type="button" value="Ramasser l'objet d'id = 1" id="RAMASSER_OBJET" />
			<input type="button" value="Déposer l'objet d'id = 9" id="DEPOSER_OBJET" />
			<input type="button" value="Sequiper de l'arme d'id = 1" id="EQUIPER_OBJET_1" />
			<input type="button" value="Sequiper de l'arme d'id = 3" id="EQUIPER_OBJET_3" />
			<input type="button" value="Se desequiper de l'arme" id="DESEQUIPER_ARME" />
		</p>

		<h2>Infos Perso'</h2>
		<p id="zone_idSalle">
			Nada !
		</p>
		<h2>Zone log</h2>
		<section id="zone_log">

		</section>

		<!-- -------------------- CODE JAVASCRIPT ----------------- -->

		<script>
			/*********** EVENEMENTS LORS DE RECEPETION D'UNE COMMUNICATION SERVEUR -> CLIENT **************/
			var socket = io.connect('http://localhost');

			/*
			 * RECEPTION DE LA REPONSE DE DEPLACEMENT DU PERSONNAGE
			 */
			socket.on('MOVE_PERSONNAGE_SC', function(currentCase) {
				if (currentCase == "ERREUR_CASE")
					insereMessage("CLIENT : nom salle = " + "ERREUR_CASE");
				else if (currentCase == "ERREUR_MOVE")
					insereMessage("CLIENT : nom salle = " + "impossible d'aller par là !");
				else {
					insereMessage("CLIENT : nom salle = " + currentCase.nom);
					modifieIdSalle(currentCase.nom, currentCase.id);
				}
			});

			/**************************************************************************************
			 * RECEPTION DE LA REPONSE POUR S'EQUIPER OU SE DESEQUIPER D'UN ITEM
			 * Retours (voir server.js) :
			 * return 1 si ok
			 * erreur : 0 si objet n'est pas dans le sac
			 * erreur : -1 si il y a déja une arme d'équipée
			 * erreur : -2  si il y a déja une armure d'équipée
			 * erreur : -3 si item n'est ni arme ni armure
			 */
			socket.on('INV_PERSONNAGE_SC', function(type, id_item, codeRetour) {
				if (codeRetour == 0) {
					insereMessage("L'item " + id_item + " n'est plus dans le sac ");
					// quitte la fonction
					return; 
				}
				if (type == "EQUIPER") {
					switch(codeRetour) {
						case 0 : insereMessage("Equipement de l'item " + idtem + " raté : Item pas dans sac !");
							break;
						case 1 : insereMessage("Equipement de l'item " + idtem + " ok !");
							break;
						case -1 : insereMessage("Equipement de l'item " + idtem + " raté : arme déja équipée");
							break;
						case -2 : insereMessage("Equipement de l'item " + idtem + " raté : armure déja équipée");
							break;
						case -3 : insereMessage("Equipement de l'item " + idtem + " raté : armure déja équipée");
							break;
					}
				} else if (type == "DEQUIPER") 
				{
					if (codeRetour == -4) 
					insereMessage("Impossible de se déséquiper de l'item " + id_item + " vous ne vous en êtes pas équipé");
					else
					insereMessage("Item " + id_item + "équipé !");
				}

				// RAFRAICHISSEMENT DE LA CASE ET DU PERSO
			});

			/**************************************************************************************
			 * RECEPTION D'UNE REPONSE POUR LA DEMANDE DE MODIF
			 * D'OBJET DANS LA CASE
			 */
			socket.on('INV_CASE_SC', function(type, id_item, codeRetour) {
				if (type == 'RAMASSER') {
					// erreur
					if (codeRetour == -3) {
						insereMessage("Erreur inconnue");
					}
					// poids insufisant
					else if (codeRetour == -1) {
						insereMessage("Impossible de ramasser l'objet : poids max atteint");
					}
					// objet pas dans case (! pas normal)
					else if (codeRetour == -2) {
						insereMessage("L'item " + id_item + " n'est plus dans la salle ");
					}
					// ramassage ok
					else {
						insereMessage("Item ramassé ! Poids total du sac : " + codeRetour);

						// modifier l'ihm : inventaire du perso et inventaire de case
					}
				}
				if (type == 'DEPOSER') {
					// erreur
					if (codeRetour == -3) {
						insereMessage("Erreur inconnue");
					}
					// objet pas dans sac (! pas normal)
					else if (codeRetour == -2) {
						insereMessage("L'item " + id_item + " n'est plus dans le sac ");
					}
					// dépôt ok
					else {
						insereMessage("Item déposé ! Poids total du sac : " + codeRetour);

						// modifier l'ihm : inventaire du perso et inventaire de case
					}
				}

				// RAFRAICHISSEMENT DE LA CASE ET DU PERSO
			});

			/**************************************************************************************
			 * RECEPTION DES INFORMATIONS SUR LA CASE
			 */
			socket.on('INFO_CASE_SC', function(currentCase) {
				if (currentCase == "ERREUR_CASE")
					insereMessage("CLIENT :: nom case = " + "ERREUR_CASE");
				else {
					insereMessage("CLIENT :: nom case = " + currentCase.nom);
					insereMessage("****LISTE DES OBJETS DE LA CASE ****");
					for (var i = 0; i < currentCase.listeItem.length; i++) {
						insereMessage(" Objet id = " + currentCase.listeItem[i].id + " - " + currentCase.listeItem[i].nom);
					}
					insereMessage("************************************");
				}
			});

			/**************************************************************************************
			 * RECEPTION DES INFORMATIONS SUR LE PERSONNAGE
			 */
			socket.on('INFO_PERSONNAGE_SC', function(currentPerso) {
				insereMessage("****LISTE DES OBJETS  DU PERSO (" + currentPerso.sacADos.length + ")****");
				for (var i = 0; i < currentPerso.sacADos.length; i++) {
					insereMessage(" Objet id = " + currentPerso.sacADos[i].id + " - " + currentPerso.sacADos[i].nom);
				}
				insereMessage("************************************");
			});

			/******** EVENEMENTS LORS DE L'APPUI SUR UN BOUTON ************/
			$('#MOVE_LEFT').click(function() {
				insereMessage("CLIENT : go gauche");
				socket.emit('MOVE_PERSONNAGE_CS', 'EST');
			});
			$('#MOVE_RIGHT').click(function() {
				socket.emit('MOVE_PERSONNAGE_CS', 'OUEST');
			});
			$('#MOVE_TOP').click(function() {
				socket.emit('MOVE_PERSONNAGE_CS', 'NORD');
			});
			$('#MOVE_BOTTOM').click(function() {
				socket.emit('MOVE_PERSONNAGE_CS', 'SUD');
			});
			$('#INFO_CASE').click(function() {
				socket.emit('INFO_CASE_CS');
			});
			$('#INFO_PERSONNAGE').click(function() {
				socket.emit('INFO_PERSONNAGE_CS');
			});
			$('#RAMASSER_OBJET').click(function() {
				// exemple : ramsser l'objet d'id 1
				socket.emit('INV_CASE_CS', "RAMASSER", 1);
			});
			$('#DEPOSER_OBJET').click(function() {
				// exemple : déposer l'objet d'id 9
				socket.emit('INV_CASE_CS', "DEPOSER", 9);
			});
			$('#EQUIPER_OBJET_1').click(function() {
				socket.emit('INV_PERSONNAGE_CS', "EQUIPER", 1);
			});
			$('#EQUIPER_OBJET_3').click(function() {
				socket.emit('INV_PERSONNAGE_CS', "EQUIPER", 3);
			});
			$('#DESEQUIPER_ARME').click(function() {
				socket.emit('INV_PERSONNAGE_CS', "DESEQUIPER", 3);
			});


			/******** FONCTIONS MODIFIANT L'IHM ************/
			/*
			 * Modifie l'id de la salle
			 */
			function modifieIdSalle(nomCase, idCase) {
				$('#zone_idSalle').text("id salle : " + idCase + " - nom salle : " + nomCase);
			}

			/*
			 * Insere un message dans la zone "zone log"
			 */
			function insereMessage(message) {
				$('#zone_log').prepend(message + "<br>");
			}

		</script>

	</body>
</html>
